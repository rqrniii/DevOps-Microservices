apiVersion: v1
kind: ConfigMap
metadata:
  name: taskgenius-config
  namespace: taskgenius
data:
  # Service Ports
  AUTH_PORT: "8080"
  TODO_PORT: "8081"
  AI_PORT: "8082"
  
  # Database Configuration (internal K8s DNS)
  DB_HOST: "postgres-service"
  DB_PORT: "5432"
  DB_NAME: "todoapp"
  
  # Service URLs (internal cluster communication)
  AUTH_SERVICE_URL: "http://auth-service:8080"
  TODO_SERVICE_URL: "http://todo-service:8081"
  AI_SERVICE_URL: "http://ai-service:8082"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-script
  namespace: taskgenius
data:
  init.sql: |
    -- Create users table
    CREATE TABLE IF NOT EXISTS users (
        id SERIAL PRIMARY KEY,
        email VARCHAR(255) UNIQUE NOT NULL,
        password VARCHAR(255) NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    -- Create todos table
    CREATE TABLE IF NOT EXISTS todos (
        id SERIAL PRIMARY KEY,
        task TEXT NOT NULL,
        completed BOOLEAN DEFAULT FALSE,
        user_email VARCHAR(255) NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (user_email) REFERENCES users(email) ON DELETE CASCADE
    );

    -- Create indexes
    CREATE INDEX IF NOT EXISTS idx_todos_user_email ON todos(user_email);
    CREATE INDEX IF NOT EXISTS idx_todos_completed ON todos(completed);
    
    -- Grant permissions
    GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO postgres;
    GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO postgres;