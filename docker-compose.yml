version: "3.9"

services:
  auth-service:
    build:
      context: ./services/auth-service
      dockerfile: Dockerfile
    container_name: auth-service
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - JWT_SECRET=${JWT_SECRET:-your-secret-key}
    networks:
      - taskgenius-network
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8080/health"]
      interval: 10s
      timeout: 2s
      retries: 3
    restart: unless-stopped

  todo-service:
    build:
      context: ./services/todo-service
      dockerfile: Dockerfile
    container_name: todo-service
    ports:
      - "8081:8081"
    environment:
      - PORT=8081
      - JWT_SECRET=${JWT_SECRET:-your-secret-key}
    networks:
      - taskgenius-network
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8081/health"]
      interval: 10s
      timeout: 2s
      retries: 3
    restart: unless-stopped

  ai-service:
    build:
      context: ./services/ai-service
      dockerfile: Dockerfile
    container_name: ai-service
    ports:
      - "8082:8082"
    environment:
      - PORT=8082
      - JWT_SECRET=${JWT_SECRET:-your-secret-key}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    networks:
      - taskgenius-network
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8082/health"]
      interval: 10s
      timeout: 2s
      retries: 3
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend/todo-frontend
      dockerfile: Dockerfile
    container_name: frontend
    ports:
      - "5173:80"
    environment:
      - VITE_AUTH_API=http://localhost:8080
      - VITE_TODO_API=http://localhost:8081
      - VITE_AI_API=http://localhost:8082
    depends_on:
      - auth-service
      - todo-service
      - ai-service
    networks:
      - taskgenius-network
    restart: unless-stopped

networks:
  taskgenius-network:
    driver: bridge